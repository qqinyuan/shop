{"version":3,"sources":["sms_util.js"],"names":[],"mappings":"AAAA,IAAI,MAAM,QAAQ,aAAR,CAAV;AACA,IAAI,SAAS,QAAQ,QAAR,CAAb;AACA,IAAI,SAAS,QAAQ,WAAR,EAAqB,MAAlC;AACA,IAAI,UAAU,QAAQ,SAAR,CAAd;;AAEA;;;AAGA,SAAS,UAAT,CAAoB,MAApB,EAA4B;AACxB,QAAI,QAAQ,CAAC,GAAD,EAAK,GAAL,EAAS,GAAT,EAAa,GAAb,EAAiB,GAAjB,EAAqB,GAArB,EAAyB,GAAzB,EAA6B,GAA7B,EAAiC,GAAjC,EAAqC,GAArC,CAAZ;AACA,QAAI,SAAS,EAAb,CAFwB,CAEP;AACjB,SAAI,IAAI,IAAI,CAAZ,EAAe,IAAI,MAAnB,EAA4B,GAA5B,EAAkC;AAC9B,YAAI,QAAQ,KAAK,IAAL,CAAU,KAAK,MAAL,KAAc,CAAxB,CAAZ;AACA,kBAAU,MAAM,KAAN,CAAV;AACH;AACD,WAAO,MAAP;AACH;AACD;AACA,QAAQ,UAAR,GAAqB,UAArB;;AAEA;;;AAGA,SAAS,QAAT,CAAkB,KAAlB,EAAyB,IAAzB,EAA+B,QAA/B,EAAyC;AACrC,QAAI,cAAc,kCAAlB;AACA,QAAI,aAAa,kCAAjB;AACA,QAAI,WAAW,8BAAf;AACA,QAAI,QAAQ,kCAAZ;AACA;AACA;;;;;AAKA,QAAI,eAAe,EAAnB;AACA,QAAI,OAAO,SAAS,MAAT,CAAgB,gBAAhB,CAAX;AACA,mBAAe,IAAI,cAAY,UAAZ,GAAuB,IAA3B,CAAf;AACA,QAAI,MAAM,WAAS,uBAAT,GAAiC,WAAjC,GAA6C,uBAA7C,GAAqE,YAA/E;;AAEA;AACA,QAAI,OAAO;AACP,YAAK,KADE;AAEP,eAAQ,KAFD;AAGP,oBAAa,GAHN;AAIP,iBAAQ,CAAC,IAAD,EAAM,GAAN;AAEZ;;AAEA;AACA;;;;;AATW,KAAX,CAcA,IAAI,gBAAgB,cAAc,GAAd,GAAoB,IAAxC;AACA,oBAAgB,OAAO,MAAP,CAAc,aAAd,CAAhB;AACA,QAAI,UAAU;AACV,kBAAU,kBADA;AAEV,wBAAgB,gCAFN;AAGV,0BAAkB,KAAK,SAAL,CAAe,IAAf,EAAqB,MAArB,GAA4B,EAHpC;AAIV,yBAAkB;;AAGtB;AACA;AARc,KAAd,CASA,QAAQ;AACJ,gBAAS,MADL;AAEJ,aAAM,GAFF;AAGJ,iBAAU,OAHN;AAIJ,cAAO,IAJH;AAKJ,cAAO;AALH,KAAR,EAMG,UAAU,KAAV,EAAiB,QAAjB,EAA2B,IAA3B,EAAiC;AAChC,gBAAQ,GAAR,CAAY,KAAZ,EAAmB,QAAnB,EAA6B,IAA7B;AACA,iBAAS,KAAK,UAAL,KAAkB,QAA3B;AACA;AACH,KAVD;AAWH;AACD,QAAQ,QAAR,GAAmB,QAAnB;;AAEA","file":"sms_util-compiled.js","sourcesContent":["var md5 = require('blueimp-md5')\r\nvar moment = require('moment')\r\nvar Base64 = require('js-base64').Base64;\r\nvar request = require('request');\r\n\r\n/*\r\n 生成指定长度的随机数\r\n */\r\nfunction randomCode(length) {\r\n    var chars = ['0','1','2','3','4','5','6','7','8','9'];\r\n    var result = \"\"; //统一改名: alt + shift + R\r\n    for(var i = 0; i < length ; i ++) {\r\n        var index = Math.ceil(Math.random()*9);\r\n        result += chars[index];\r\n    }\r\n    return result;\r\n}\r\n// console.log(randomCode(6));\r\nexports.randomCode = randomCode;\r\n\r\n/*\r\n向指定号码发送指定验证码\r\n */\r\nfunction sendCode(phone, code, callback) {\r\n    var ACCOUNT_SID = '8aaf07086ab0c082016ab60faacd0472';\r\n    var AUTH_TOKEN = 'd9da90eeb2a54ff0b7fe77920837e54e';\r\n    var Rest_URL = 'https://app.cloopen.com:8883';\r\n    var AppID = '8aaf07086ab0c082016ab60fab2a0479';\r\n    //1. 准备请求url\r\n    /*\r\n     1.使用MD5加密（账户Id + 账户授权令牌 + 时间戳）。其中账户Id和账户授权令牌根据url的验证级别对应主账户。\r\n     时间戳是当前系统时间，格式\"yyyyMMddHHmmss\"。时间戳有效时间为24小时，如：20140416142030\r\n     2.SigParameter参数需要大写，如不能写成sig=abcdefg而应该写成sig=ABCDEFG\r\n     */\r\n    var sigParameter = '';\r\n    var time = moment().format('YYYYMMDDHHmmss');\r\n    sigParameter = md5(ACCOUNT_SID+AUTH_TOKEN+time);\r\n    var url = Rest_URL+'/2013-12-26/Accounts/'+ACCOUNT_SID+'/SMS/TemplateSMS?sig='+sigParameter;\r\n\r\n    //2. 准备请求体\r\n    var body = {\r\n        to : phone,\r\n        appId : AppID,\r\n        templateId : '1',\r\n        \"datas\":[code,\"1\"]\r\n    }\r\n    //body = JSON.stringify(body);\r\n\r\n    //3. 准备请求头\r\n    /*\r\n     1.使用Base64编码（账户Id + 冒号 + 时间戳）其中账户Id根据url的验证级别对应主账户\r\n     2.冒号为英文冒号\r\n     3.时间戳是当前系统时间，格式\"yyyyMMddHHmmss\"，需与SigParameter中时间戳相同。\r\n     */\r\n    var authorization = ACCOUNT_SID + ':' + time;\r\n    authorization = Base64.encode(authorization);\r\n    var headers = {\r\n        'Accept' :'application/json',\r\n        'Content-Type' :'application/json;charset=utf-8',\r\n        'Content-Length': JSON.stringify(body).length+'',\r\n        'Authorization' : authorization\r\n    }\r\n\r\n    //4. 发送请求, 并得到返回的结果, 调用callback\r\n    // callback(true);\r\n    request({\r\n        method : 'POST',\r\n        url : url,\r\n        headers : headers,\r\n        body : body,\r\n        json : true\r\n    }, function (error, response, body) {\r\n        console.log(error, response, body);\r\n        callback(body.statusCode==='000000');\r\n        // callback(true);\r\n    });\r\n}\r\nexports.sendCode = sendCode;\r\n\r\n/*\r\nsendCode('13716962779', randomCode(6), function (success) {\r\n    console.log(success);\r\n})*/\r\n"]}